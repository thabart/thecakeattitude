<html>
	<head>		
		<meta charset="utf-8">
		<title>Cake attitude</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2" />
		<!-- Jquery -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js"></script>
		<!-- Bootstrap -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/js/bootstrap.js"></script>
		<!-- Phaser lib -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/2.6.2/phaser.js"></script>
		<!-- CSS Libraries -->
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" >
		<style type="text/css">	
		</style>
	</head>
	<body>
	</body>
	<script type="text/javascript">
		$(document).ready(function() {			
			var tchat = function() {			
				this.fields = {
					game: null,
					map: null,
					cursors: null,
					player: null,
					layers : {
						alimentation : null,
						earth : null,
						ground: null,
						collision : null
					}
				};
					
				function preload() {
					this.fields.game.load.tilemap('game', 'http://localhost:3000/public/map/map.json', null, Phaser.Tilemap.TILED_JSON);
					this.fields.game.load.image('tallgrass', 'http://localhost:3000/public/map/tilesets/tallgrass.png');
					this.fields.game.load.image('farming_fishing', 'http://localhost:3000/public/map/tilesets/farming_fishing.png');
					this.fields.game.load.image('tiles', 'http://localhost:3000/public/map/tilesets/tiles.png');
					this.fields.game.load.image('player', 'http://localhost:3000/public/map/character/phaser-dude.png');
				}
				
				function create() {	
					// Start the Arcade physics systems.
					this.fields.game.physics.startSystem(Phaser.Physics.ARCADE);
					// Change background color.				
					this.fields.game.stage.backgroundColor = '#787878';
					// Add tile map and tile set image.
					this.fields.map = this.fields.game.add.tilemap('game');
					this.fields.map.addTilesetImage('tallgrass', 'tallgrass');
					this.fields.map.addTilesetImage('farming_fishing', 'farming_fishing');
					this.fields.map.addTilesetImage('tiles', 'tiles');
					// Add the layers.
					this.fields.layers.collision = this.fields.map.createLayer('Collision');
					this.fields.layers.ground = this.fields.map.createLayer('Ground');
					this.fields.layers.earth = this.fields.map.createLayer('Earth');
					this.fields.layers.alimentation = this.fields.map.createLayer('Alimentations');
					// Specify which tile can collide.
					this.fields.map.setCollision(421, true, 'Collision');		
					// Add the player to the world.
					this.fields.player = this.fields.game.add.sprite(0, 0, 'player');
					this.fields.game.physics.arcade.enable(this.fields.player);
					// Change the world size the match the size of this layer.
					this.fields.layers.earth.resizeWorld();				
					// Make the camera follow the sprite.
					this.fields.game.camera.follow(this.fields.player, Phaser.Camera.FOLLOW_LOCKON, 0.1, 0.1);	
					this.fields.cursors = this.fields.game.input.keyboard.createCursorKeys();				
				}
							
				function update() {
					if (this.fields.game.physics.arcade.collide(this.fields.player, this.fields.layers.collision)) {
						console.log('boom');
					}
					
					this.fields.player.body.velocity.x = 0;
					this.fields.player.body.velocity.y = 0;
					// game.physics.arcade.collide(player, collisionLayer); 
					if (this.fields.cursors.left.isDown)
					{
						this.fields.player.body.velocity.x = -200;
					}
					else if (this.fields.cursors.right.isDown)
					{
						this.fields.player.body.velocity.x = 200;
					}

					if (this.fields.cursors.up.isDown)
					{
						this.fields.player.body.velocity.y = -200;
					}
					else if (this.fields.cursors.down.isDown)
					{
						this.fields.player.body.velocity.y = 200;
					}
				}
				
				this.init = function() {
					var self = this;
					this.fields.game = new Phaser.Game(800, 600, Phaser.AUTO, 'Cake attitute', { preload : function() { preload.call(self); }, create : function() { create.call(self); }, update : function() { update.call(self); } });
				};
			};
			
			var t = new tchat();
			t.init();
		});
	</script>
</html>